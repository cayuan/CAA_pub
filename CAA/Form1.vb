

''+++++++++++++++++++++++++oosyhdddddddddddmmmmmmmmNNNNNNNmdmmNNNNNNNNNNNNmddhyhddhdmmmmmmmmmmmmmdddhh
''+++++++++++++++++++++osyhhddddddddmmmmmmmmmmmmmmNNNNNNNNNNNNNNNNNNNNNNNNNNmmddhddmmNNNNNNNNNNNNNNmmm
''++++++++++++++++++oyhddddddddddmmmmmmmmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNmdddmmmNNNNNNNNNNNNNNNN
''+++++++++++++++ossyddddhhhdddddmmmmmmmmmmmmNNNNNNNNNNNNNNNNNNNNNNNNNNMMMMNNNNNmdmmmmmNNNNNNNNNNNNNNN
''++++++++++++ooosyhhhdddhhhhddddddmmmmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNMMNNNmmmmmNNNNNNNNNNNNNNN
''o+ooooooooooosyhhhhdddddmmmmddmmmmmmmmNNNNNNNNNNNNNNNmmmmmmNNNNNNNNNNNNNMNNNMMMMNNmmmNNNNNNNNNNNNNNN
''++++++++++ooshhhhddddddhdddddddmmmmmmmNNNNNNNNNNNNNNmmmmmmmmmmNNNNNNNNNNNNNMMMNMNNNNmmmmmmmNmNNNNNNN
''+++++++++++shhdddddddddddmmmddmmmmmNNNNNNNNNNNNNNNmmmmmmmmmmmmNNNNNNNNNNNNNNNNNMNNNNmdhhhhhhhhhhhhhh
''/////////+sdddddddddddddddddmmmmmmmNNNNNNNNNNNNNNmmddddmmmmmmmmNNNNNNNNNNNNMNNNNNNNNmdhsoooooooooooo
''/////////odmmdddddddddddmmmmmmmmmmmmNNNNNNNNNNNNNmdhhddmmmmmmmNNNNNNNNNNNNNNMNNNNNNNNhyy+///////////
'':::::://+dmmNmmddddmdmmmmmmmmmNNNNNmmmmNNNNmmmmmmmmdddmmmmmmNNNNNNNNNNNNNNNNNNNNNNNNNdsy+::::://////
''//:::::/ymmmmmmddddmmmmdmmmmmmNNNNNNNmmmmmdhdhyyhddhhddmmmmmmmNNNNNNNNNNNNNNNNNNNNNNNNho+///////////
''/////:/+mmmdddddddmmdmddmmmmmmNNNNNNNmmdddhyhyssssyyyhhddddmmmmmmNNNNNNNNNNNNNNNNNNNNNm++///////////
''++/////ymdddddddddddmdddmmmmmmmNNmmmmmdhysooso++/++oosssyhhhddmmmmmmNNNNNNNNNNNNNNNmNNNs////////////
''+++///odmddddddmdddddddmmmmmmmmmmmmdhyso+++/////////+osossyyhhhdmmmmmNNNNNNNNNNNNNNNNmNs////////////
''oo+++sddddddddddddddhhddddddmdddhyso+//:::::::::::/+++oooossyhhhdddmmmNNNNNNNNNNNNNNNNdo////////////
''soo+odmmmmmmmmmmmddhyyyhhhhhhyso+//::::------:::::/+++oooosssshhhdddmmmNNNNNNNNNNNNNNmd+////////////
''yssosdNmmmmmmmmmmdhyssysssso+///:::::-------:::::://++ooooosssyhdhdddmmmNNNNNNNNNNNNNNms+///////////
''yyssydNNNmmmmmmmmdhyysooo/////:::----------:::://:/++++oooooossyhddddmmmmmNNNNNNNNNNNNms////////////
''hyysohmmmmmmmmmmdddho++/::::::::-----------::::::://+++++oooossyyhddddmmmmmNNNNNNNNNNNh+////////////
''hhysohmNNmddmmmddddyoo::--:::::------------:::::::////++++ooossyyyhdddmmmmNNNNNNNNNNNNd/////////////
''dhysohmmmdmmmmmmmddys/:-----------------:---::::::://+++++ooossyyyhddddmmmNNNNNNNNNNNNh+/::://://::/
''dhyssohmmmmNNmmdmdhs+:-----------------:---------::/+++++++oossyyhhhddddmmNNNNNNNNNNNmd/::::::::::::
''dhysooyddmNNNNmddhyo/:--------...-.-----------.---://++++++ooossyhhhhhhddmmNNNNNNNNNNhs/::::::::::::
''dhyso+oyyhdmNNmmdhs//-:-.----.......---:------..--::///++ossssssyyyhhhhhhdmNNNNNNmmmdhys/:::::::::::
''dhyso++o++oshdmmmho/::---::://////:::::::----:--::/+ossyyyyyyyyyyyyyyyyhhhmNmmNmdddhhyyyo::::::::---
''hhyso+++::///:/ymd+::-::////++oo+oo+++++/:--:////ossssssoosssyyhhhhyyyyhhdddmNNdddhhhyyys::::::-----
''yysso++/-+o+/:-/dh+::-::------:://++++++/:-:/+o++++////++oossyyyyhhhyyyyyhhdNNNmdhhhyyyys:::::::::--
''ssoo++++:/+/:--:ss::-::///::://+oossyso+/:--/+oo++oo+++++osssyyhhhddhyyhyyyhmNNmdhhhyyys+:::::::::::
''oo+++++++:/+/:-/y+//++:--:::/++oyyhyysoss+/+oyyysooossosyyyhhhhhyyymNmhyssshdmmmdhhhhyso/:::::::::::
''+++++++ooo::+/:+yoyhyo-.--::/+++osssoo/:shssyhdyysoo++oosssyyyyyyyydhyyssssyhhdmdhhhyy+:::::::::::::
''oooooooooss/:///o/-:s/-..--:://++ooo+/::oo/:/ohhyso+++++ooossssssssyyysssssyyydmdhyys/::::::::::::::
''oooooooooooo/-::::---+/-----:://///:::://:--:+syyyso+++++++++++oosysssssssyysydhhhys/:::::::::::::::
''osssssoo+++++/-.-..--.-:::::://///////:---.-:+osssyssoo+++++++++ossssysyyyyysyhyhyy+::::::::::::::::
''oossysoo++///+:.-..--....-----::::::---....-:/+ssssso+///:::::/+oosssyyyyyyssyhhyys:::::::::::::::::
''oossyyso++///++.....---.......----:::--....-:/+osyyys+//::::://++ossyyyyyyysshyyys+:::::::::::::::::
''oosssysso+++++o+-..-----.....---:::::-..`...-:+oossyyso//:::://++ossyyyyyyyys+ooo+::::::::::::::::::
''ooossssssooooooss+++/----..---::::://-.....-:/+oosssyhs+/::////+ossyyyyyyyyyo:::::::::::::::::::::::
''oooosssssssooosssyyys:------::::::::--://:::/+osyssyyyo+//////++osyyyyyyyyyyo////:::::::://:::::::::
''+ooooosssssooooossyyy+-----:::--::-...---://+/++oosssoooo+///++ossyyyyyyyyyy+///////::://///////:::/
''++++ooossssoooooossyys/----::-----.....---:/+//++oosssooooo+++oossyyyyyyyyys/////////:://///////////
''////++ooosssooooosssyys/---------....-----:/+//+oooosssssssso+oossyyyyyyhhyo////////////////////////
''::///++oosssssssssssssss:--------.--------::///oooossssssssys+oossyyyyyyhhyo/////////++++++++++++++/
''::://++ossyyyyyssoooooooo:------------:///++++ssssyyyyysyyyysooossyyyyyhhyhs+/++++++++++++++++++++++
''////++oosssssyysooo+++++++:------:://+ooo+///oooosyyyhhsssssoooosyyyyyhhhhdy+:+ooooooooooooooooooooo
''//+++oossssssssooo+++++++++:-----:/:::/sss//://+ossyyyyssssoooosyyyyyhhhhhmy/:/hsooooooooooooooooooo
''+++++oooooooooooo+++++++++++/---::::--:::+ooosoooosssyyyssssoosyyyyhhhhhydd+:::yhyysoooooooooooooooo
''+++++++++++++++++++++++++++++---::::::::::::/:/+++syhhysssssssyyyyhhhhhhhs/::::ydhhhhsoooooooooooooo
''+++++++//+++++++++++++++++++-`-::-----::////+++ossyyyssssosssyyyhhhhhhhy+::::::ymddyoddyoooooooooooo
''oo++++//////+++++++++++++++/`.:+:--------:://+++oooooooooossyyyyyyhhyyo:::::::+dmmmmshmmdhso++++++oo
''sooo++++////+++++++++++++oo: -+o/---------:://+++++++ooooosyyyyyyyyys/:--::::/hmmmmmymmmmmmdyo+++ooo
''ssooo+++++++++++oossyhhhhhy: -oys-.--::::://++++ooo+++oossyyyyyyys+:----:::::ymmmmNNmmmmmmmmmmdyoooo
''sssoooooossyyhdddmdddhhhhyy: `/hh:..--:://++++ooooo++oooosssssso/-------:--:ymddmNNmmmmmmmmmmNmmmdhs
''hdddddddddddmmmddhhyyyyyyyy/  `sdo-..---:://++++++++++oooooo++:-...-------:ymdyymmmmmmmmmmmNNNNNNNNm
''dddhhhhhhhddddhyyyyyyyyyyyh+   `oy+:------::////+////+++//:-..`...-------:ymdhhdmmmmmmmmmmmNNNNNNNNN
''hhhhhyyhhddddhyyyyyyyyyyyhh/    `/yo/:-------:::::://::-.``````...----.-:ydmhhdmmmmmmmmmmmmmmmNNNNNN
''hhhyhyyyhdddhyyyyyyyyyyyydo/`     .os+/:------------..`````````.......--sddddmmmmmmmmmmmmmmmmmmmmmmm
''hyyyhyyydddhyyyyyyyyyyyyhy+/`      `-oo+/::------.`` ```````````......-odyhddmmmmmmmmmmmmmmmmddddmdd
''yyhhhyyhhdhyyyyyyyyyyyyyho:+`        `-+o+//:-.`     ```````````.....-oddhddddddddmmmmmmmmmmmddmmmmd
''yhhhyyyhhhhyyyyyyyyyyyyhy:-+-           .:+/-`      ```` ``````......+hdhdddddddddmmmmmmmmmddddmmmdd
''hhhhyyyhhhyyyyyssyyyyyyho::+/        `./+:.              ``````...../hhhdddddddddddmmmmmmddddddddddd
''hhhyyyyyhyyyyyyyyyyyyyys+-:o+      `+syyyhh/`          `````.```.`.:yhhhhddddddddddddmmmdddddddddddd
''hhyyyyyyyyyyyyyyyyyyyyyoo//o/     .yyyhhhhhhs.        ``````.`..`.:yhhhhhhdhdddhddddddddddddddddddhh



''`````````````````````````````````````````````````````````````````````.:/:.``````````````````````````
''````````````````````````````````````````````````````````````.````.://-..````````````````````````````
''```````````````````......``....................................:::...```````````````````````````````
''````````````.`..............................................-::-............``..````````````````````
''``````````................................................-/:-...........................```````````
''```````................................................/o//-...............................```.`````
''````...............................................:s-/s/-......................................````
''..................................................:ho+/.............................................
''..........................................-.--:s--sy+:-.............................................
''.....................................-....----yo-+/------...........................................
''..............................--.------------oo/o:-------...........................................
''..............................---------------oy+------------..--....................................
''..........................-------------------/:----------------------------------..--...............
''......................-------------------ss-:+---------------------------------------------.........
''...................---------------:y----:dy-+:-----------------------------------------------.......
''...............-..---------------/sh:---/do:+--------------------------------------------------.....
''..............------------:yy:--/s:+o---/m///----------------------------------------------------..-
''............--------------o/+s:/s:-:y---/h:+:-------------------------------------------------------
''............-------------o+--+ys:---y:-:yy/+--------------------------------------------------------
''...........-------------/+---/do----+s/soy+:-:------------------------------------------------------
''.........--------------:s:--/s/y/---:+o/:ss:-------::-----------------------------------------------
''.......--------://:----o/--/s:-/y:-::--::sy:---::::::-----------------------------------------------
''......--------o+:/s---:y--/s:---oo::--:::+s:::-:::::::-::----::-------------------------------------
''......-------+o---+o:-o+-:y/----/y:::::::/s::::::::::::::::::::::::::::::::::::::-:::---------------
''...----------y:----:-:y:--:++///os:::::::/h::::::::::::::::::::::::::::::::::::::::-:::-------------
''...---------:y-------/s-----::///:-::::::/d::::::::::::::::::::::::::::::::::::::::::-:-------------
''.-----------:y-------s/----::-:::::::::::/h+::::::::::::::::::::::::::::::::::::::::::::------------
''------------/y------/s:--::::::-:::::::::/ss::::::::::::::::::::::::::::::::::::::::::::------------
''------------:y:----:s+-:-:::::::::::::::::ss:::::::::::::::::::::::::::::::::::::::::::::::---------
''------------:y/:--:+s:::::::::::::::::::::sy/:::::::::::::::::::::::::::::::::::::::::::::::--------
''-------------+s:::/y:--:::::::::::::::::::oh+:::::::::::::::::::::::::::::::::::::::::::::----------
''-------------:oo++s/--::::::::::::::::::::/hs::::::::::::::::::::::::::::::::::::::::::::::---------
''---------------://:::-:::::::::::::::::::::sd::::::::::::::::::::::::::::::::::::::::::::-:---------
''-----------:-:-::::::::::::::::::::::::::::/o::::::::::::::::::::::::::::::::::::::::::::::---------
''------:---:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-----------
''---------::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-------------
''-:----::::::::--::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::----------------
'':::::::::::::-:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::---------------




' The ascii art
'  pure text: https://patorjk.com/software/taag/#p=testall&f=Graffiti&t=test
'  draw by yourself: https://kirilllive.github.io/ASCII_Art_Paint/ascii_paint.html
'
'
'
'
Imports System.Threading
Imports System.IO

'Imports MathNet.Numerics.LinearAlgebra.Double

Imports CAA.CAA


Imports Microsoft.Office.Interop

Public Class Form1


    Public USER As CAA.CAA_USER
    Public WEI() As CAA.CAA_WT
    Dim USERPATH As String


    Public ORDER As CAA.CAA_ORDER
    Public ARTCO As CAA.CAA_ARTCO



#Region "Delegation"
    Public Delegate Sub txt_Delegate(ByVal txt As String)
    Public Sub Addtxt_2_txtText(ByVal txt As String)
        If Me.InvokeRequired Then
            Dim d As New txt_Delegate(AddressOf Addtxt_2_txtText)
            Me.Invoke(d, New Object() {txt})
        Else
            txtOutput.AppendText(txt & Environment.NewLine)
        End If
    End Sub



#End Region



#Region "Form load"


    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles Me.Load
        Dim x As Integer = CAA.CAA_const_structure.KeyWindowStartPosition.form1_x

        Dim y As Integer = CAA.CAA_const_structure.KeyWindowStartPosition.form1_y
        Me.Location = New Point(x, y)
        lblCopyright.Text = CAA.CAA_const_structure.CAA_copyright.copywright
        lblVersion.Text = My.Application.Info.Version.ToString



        initializeMe()

    End Sub



    Private Sub initializeMe()


        ' use profile 
        USER = New CAA.CAA_USER
        USERPATH = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData) + "\" +
                                 My.Application.Info.AssemblyName + "\"
        ' the environment only work in form

        USERPATH = CAA.CheckFolderSurfix(USERPATH)
        USER.USER_file_folder = USERPATH

        USER.readMe()


        'WEI
        ReDim WEI(USER.WeightingFile_Title.Count - 1)
        For ii As Integer = 0 To WEI.Count - 1
            WEI(ii) = New CAA_WT
            If USER.WeiFileExists_YesNo(ii) Then
                WEI(ii).defineMefromFile(USER, ii)
            End If
        Next



        'ORDER
        ORDER = New CAA_ORDER

        'ARTCO
        ARTCO = New CAA_ARTCO

        '---
        ' UI
        '---
        txtWorkDir.Text = USER.Current_Working_Folder





    End Sub


    Private Sub checkUSERProfile_Folder(pp As String)

        If Not (IO.Directory.Exists(pp)) Then
            IO.Directory.CreateDirectory(pp)
        End If

    End Sub


#End Region




#Region "UI"
    Private Sub cmdExit_Click(sender As Object, e As EventArgs) Handles cmdExit.Click
        Call UnloadMe()
    End Sub

    Private Sub ExitToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ExitToolStripMenuItem.Click
        Call UnloadMe()
    End Sub

    Private Sub ToolStripMenuItem1_Click(sender As Object, e As EventArgs) Handles ToolStripMenuItem1.Click
        CAA_USR_UI.ShowDialog()

    End Sub

    Private Sub WeightingToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles WeightingToolStripMenuItem.Click
        CAA_Weighting_Modify_UI.ShowDialog()
    End Sub
    Private Sub cmdChangeWeighting_Click(sender As Object, e As EventArgs) Handles cmdChangeWeighting.Click
        CAA_Weighting_Modify_UI.ShowDialog()
    End Sub

    Private Function folderselection() As String
        FolderBrowserDialog1.RootFolder = Environment.SpecialFolder.MyComputer

        FolderBrowserDialog1.ShowDialog()

        Dim folderpath As String = FolderBrowserDialog1.SelectedPath

        If IO.Directory.Exists(folderpath) Then
            Return CheckFolderSurfix(folderpath)
        Else
            Return Nothing
        End If

    End Function
    Private Function read_output_return_full_path(Typ As OpenFileType, Optional workdir As String = "C:\Temp",
                                                        Optional fileDescription As String = "") As String

        Dim filter_string As String
        Select Case Typ
            Case OpenFileType.csv
                filter_string = "csv files (*.csv)|*.csv|All files (*.*)|*.*"
            Case OpenFileType.json
                filter_string = "json files (*.json)|*.json|All files (*.*)|*.*"
            Case Else
                filter_string = "All files (*.*)|*.*"
        End Select


        '? open a file dialog 
        With OpenFileDialog1
            .Multiselect = False
            .CheckFileExists = True
            .ReadOnlyChecked = True
            .InitialDirectory = workdir
            .Filter = filter_string
            .Title = fileDescription
            .ShowDialog()
        End With

        Dim outname As String = ""

        If IO.File.Exists(OpenFileDialog1.FileName) Then
            outname = OpenFileDialog1.FileName
        End If
        Return outname
    End Function
#End Region


#Region "Form "



    Private Sub UnloadMe()
        Me.Close()
    End Sub

    Private Sub cmdStop_Click(sender As Object, e As EventArgs) Handles cmdStop.Click
        Stop
    End Sub



#End Region


#Region "working Folder"
    Private Function assignTargetFolder_direct() As String
        Dim Message, Title As String
        Message = "Direct input the target folder "    ' Set prompt.
        Title = "Folder Path"    ' Set title.

        ' Display message, title, and default value.
        Dim folderpath As String = InputBox(Message, Title, "")

        If IO.Directory.Exists(folderpath) Then
            Return CheckFolderSurfix(folderpath)

        Else
            Return Nothing
        End If
    End Function



    Private Sub cmdChangeDir_Click(sender As Object, e As EventArgs) Handles cmdChangeDir.Click
        Dim folderp As String = assignTargetFolder_direct()
        If folderp <> "" Then
            USER.Current_Working_Folder = folderp
            txtWorkDir.Text = folderp
            USER.writeMe()
            Addtxt_2_txtText("Folder changed." + vbNewLine)
        End If
    End Sub


    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Dim folderp As String = folderselection()
        If folderp <> "" Then
            USER.Current_Working_Folder = folderp
            txtWorkDir.Text = folderp
            USER.writeMe()
        End If
    End Sub


#End Region

#Region "ORDER"



    Private Sub cmdARTCO_Click(sender As Object, e As EventArgs) Handles cmdARTCO.Click
        If txtWorkDir.Text = "" Then
            MsgBox("Assgin the WorkDir first. ")
            Exit Sub
        End If

        Dim fi As String = read_output_return_full_path(OpenFileType.csv,
                                                        USER.Current_Working_Folder,
                                                        "Open ORDER ORIGINAL CSV")

        If ARTCO.defineMEFromCSV(USER.Current_Working_Folder,
                                 IO.Path.GetFileName(fi)) = 1 Then
            Addtxt_2_txtText("ART-CO read from file: " + IO.Path.GetFileName(fi) + ".")
            Addtxt_2_txtText("ART-CO count= " + ARTCO.lstARTCO.Count.ToString + ".")
            Addtxt_2_txtText("")
        End If

    End Sub




    Private Sub cmdGetOrder_Click(sender As Object, e As EventArgs) Handles cmdGetOrder.Click
        If txtWorkDir.Text = "" Then
            MsgBox("Assgin the WorkDir first. ")
            Exit Sub
        End If

        If ARTCO.lstARTCO.Count = 0 Then
            MsgBox("Define ART-CO before start. ")
            Exit Sub
        End If

        Dim fi As String = read_output_return_full_path(OpenFileType.csv,
                                                        USER.Current_Working_Folder,
                                                        "Open ORDER ORIGINAL CSV")
        If ORDER.defineMeFromORIGINALCSV(USER.Current_Working_Folder,
                                      IO.Path.GetFileName(fi),
                                      ARTCO) = 1 Then
            Addtxt_2_txtText("ORDER read from file: " + IO.Path.GetFileName(fi) + ".")
            Addtxt_2_txtText("ORDER count= " + ORDER.lstORD.Count.ToString + ".")
            Addtxt_2_txtText("")
        End If

    End Sub
#End Region


#Region "TEst"
    Private Sub cmdtest_Click(sender As Object, e As EventArgs) Handles cmdtest.Click

        'test read

        'WEI(0).defineMefromFile(USER.Base_Data_Folder,
        '                        0,
        '                        USER.WeightingFile_Type(0),
        '                        USER.WeightingFile_Title(0),
        '                        USER.WeightingFile_Name(0))


        'WEI(1).defineMefromFile(USER.Base_Data_Folder,
        '                        1,
        '                        USER.WeightingFile_Type(1),
        '                        USER.WeightingFile_Title(1),
        '                        USER.WeightingFile_Name(1))


        'WEI(0).defineMefromFile(USER, 0)
        'WEI(1).defineMefromFile(USER, 1)



        'WEI(0).exportMe2File("Test.csv")
    End Sub






#End Region



End Class
